{{ define "main" }}

{{ if site.Params.ShowBreadCrumbs }}
  {{ partial "breadcrumbs.html" . }}
{{ end }}

{{ $all := where site.RegularPages "Section" "blog" }}
{{ $paginator := .Paginate (sort $all "Date" "desc") }}

{{ partial "blog-filters.html" (dict "pages" $all) }}

<section class="posts-grid">
  {{ range $paginator.Pages }}
  {{/* Trouver une image de couverture : front-matter cover.image, sinon une ressource "cover*" dans le bundle, sinon
  params.images[0] */}}
  {{ $cover := "" }}
  {{ if .Params.cover.image }}
  {{ $cover = .Params.cover.image | absURL }}
  {{ else if .Resources.GetMatch "cover*" }}
  {{ $img := .Resources.GetMatch "cover*" }}{{ $cover = $img.Permalink }}
  {{ else if .Params.images }}
  {{ $cover = (index .Params.images 0) | absURL }}
  {{ end }}

  <article class="post-entry post-card">
    <a class="post-card__media {{ if eq .Params.cover.fit " contain" }}is-contain{{ end }}" href="{{ .RelPermalink }}"
      aria-label="{{ .Title }}">
      {{ with $cover }}
      <img src="{{ . }}" loading="lazy" alt="{{ $.Params.cover.alt | default $.Title }}">
      {{ else }}
      <div class="post-card__placeholder" aria-hidden="true"></div>
      {{ end }}
    </a>

    <header class="entry-header">
      <h2 class="post-card__title"><a href="{{ .RelPermalink }}">{{ .Title }}</a></h2>
    </header>

    <section class="entry-content">
      <p>{{ with .Params.summary }}{{ . }}{{ else }}{{ .Summary }}{{ end }}</p>
    </section>

    <footer class="entry-footer">
      <span>{{ .Date | time.Format "2006-01-02" }}</span>
      {{ with .Params.categories }} · <span>{{ delimit . ", " }}</span>{{ end }}
      {{ with .ReadingTime }} · <span>{{ . }} min</span>{{ end }}
    </footer>

    <a class="entry-link" aria-label="post link to {{ .Title }}" href="{{ .RelPermalink }}"></a>
  </article>
  {{ end }}
</section>

{{ partial "pagination.html" . }}
{{ end }}